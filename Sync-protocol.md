<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
</head>
<body>

# بروتوكول AXON: النظرة العامة والميزات

### **1. مقدمة: لماذا AXON؟**
جاء اختراع بروتوكول **AXON** لسد فجوة تقنية عميقة؛ وهي عدم توفر "نقطة انطلاق موحدة" تجمع بين كفاءة الأنظمة المحلية وقوة الأنظمة السحابية والتعاونية. المطور اليوم يجد نفسه في حيرة عند محاولة بناء الأنظمة، خاصة في كيفية بناء طبقة الاستمرارية (Persistence) مع تقنيات الـ P2P. يوفر **AXON** هذا المسار الموحد، مما يسمح للمطور بالتركيز على بناء الميزات بدلاً من الغرق في تفاصيل الربط بين المصادر.

---

### **2. الميزات: التقاء المحاور (The Convergence)**
يعمل بروتوكول **AXON** كجسر ينهي الصراع بين عدة أقطاب تقنية كانت تُعتبر سابقاً جزرًا منعزلة:

* **الأداء المحلي (Local-First):** يمنح القدرة على التعامل مع البيانات ومعالجتها محلياً بسرعة فائقة، مما يجعل النظام يستجيب فوراً لتفاعلات المستخدم.
* **الاستمرارية وترتيب الأحداث (Offline-First):** يضمن بقاء النظام فعالاً عند انقطاع الاتصال؛ حيث يقوم الممثل بمعالجة البيانات وترتيب الأحداث زمنياً ومنطقياً، ويضمن تماثلها مع العالم الخارجي فور توفر الاتصال.
* **التعاون اللحظي (Collaborative):** يدعم القدرة على العمل الجماعي اللحظي بين عدة ممثلين (Actors) عبر قنوات الأقران (A2A)، مما يوفر تجربة تعاونية سلسة.
* **تمكين الـ Serverless و Passive Cloud:** لا يفرض البروتوكول بنية تحتية معينة؛ بل يمنح حرية الاعتماد الكامل على قنوات الأقران (بما يحقق مفهوم الـ Serverless الحقيقي) أو الاعتماد على المصادر السحابية كمخازن خاملة (Passive Cloud)، أو الجمع بينهما.
* **الخصوصية وسيادة البيانات (Privacy):** البيانات ملك للمستخدم بالكامل. الممثل (Actor) هو المتحكم الوحيد في مسار بياناته، مكان تخزين نسخته الأولى، وكيفية تشفيرها.

---

### **3. الملخص التقني للبروتوكول (Technical Protocol Abstract)**

بروتوكول **AXON** هو معيار لتنسيق البيانات بين **النسخة المتماثلة (Replica)** و**المصادر المتعددة (Multi-Sources)**، يرتكز على دور **الممثل (Actor)** كمدير مستقل للنسخ المتماثلة. يتميز البروتوكول بالآليات التالية:

* **هيكلية بيانات موحدة ومحايدة:** صُمم البروتوكول ليعمل فوق هيكل بيانات مبسط يتكون من (**List, Item, Field**). هذا التصميم يجعله محايداً تماماً تجاه الأنواع التقليدية لقواعد البيانات (مثل SQL و NoSQL)؛ حيث يتم تمثيل أي نوع بيانات ضمن هذا الهيكل المرن والموحد.
* **ثنائية التنسيق:** ينظم البروتوكول العلاقة بين **النسخة الأولى (First Replica)** كمرجع سيادي موثوق ودائم التوافر، وبين **المصادر البعيدة (Remote Sources)** بمختلف أنواعها.
* **كفاءة وموثوقية المزامنة:** يعتمد البروتوكول على خوارزميات محكمة ودقيقة وفائقة الفعالية، خالية من العشوائية وموافقة للمنطق تماماً.
    * يتم مزامنة النسخ بالاعتماد على **نقاط تفتيش دقيقة ومنطقية** تضمن الكفاءة القصوى.
    * يمتلك البروتوكول نظاماً صارماً لـ **حل التعارض وضمان ترتيب الأحداث**، مما يوفر تماثلاً كاملاً في جميع النسخ.
    * **الحذف القطعي والتطهير:** الحذف في البروتوكول يعني الحذف النهائي؛ فلا مجال لوجود بيانات لا فائدة منها. يتم تتبع آثار الحذف بدقة متناهية لضمان تماثل ونظافة كافة النسخ المتماثلة عبر جميع المصادر.
* **الحياد الهيكلي للشبكة:** يوفر قواعد مرنة تسمح بالعمل عبر مسارات متنوعة (P2P، Cloud، أو Hybrid).
* **استقلالية الوسيط:** يركز البروتوكول على "منطق حركة البيانات" بين النسخ وتوقيتها، مما يجعله قابلاً للعمل فوق أي وسيط تخزين أو تقنية نقل.




# مصادر الممثل (Actor Sources)

في بروتوكول **AXON**، يمثل الممثل (Actor) المنسق الذكي الذي يدير تدفق البيانات بين مستويين أساسيين من المصادر لضمان استمرارية العمل وتماثل الحالة.

---

## 1. النسخة الأولى (First Replica)
تُعرف بأنها المصدر الأول والموثوق، وهي الركيزة الأساسية التي تضمن استمرارية عمل النظام تحت أي ظرف.

* **التوافر المطلق (Always Available):** صُممت هذه النسخة لتكون متاحة للممثل في جميع الظروف؛ بحيث لا يتوقف الممثل عن أداء مهامه، معالجة البيانات، أو تنفيذ عمليات CRUD حتى في حالة الانقطاع الكامل لكافة مصادر الشبكة (Network Sources).
* **استقلالية المعالجة:** يعمل الممثل على هذه النسخة بشكل أصيل، مما يضمن عدم وجود نقطة فشل واحدة (Single Point of Failure) تعيق أداء النظام.
* **مسؤولية التماثل:** يقع على عاتق الممثل مسؤولية إدارة هذه النسخة وضمان تماثلها (Synchronization) مع المصادر الأخرى فور توفرها.
* **مرونة التموضع:** لا يفرض البروتوكول أن تكون النسخة محلية؛ بل يمكن أن يمتلك الممثل الحرية الكاملة في تحديد موقع استضافتها (سواء كانت محلية أو في بيئة خاصة) بشرط تحقيق معيار التوافر الدائم الخاص بالممثل.

---

## 2. مصادر الشبكة (Network Sources)
هي القنوات التي تسمح بتبادل البيانات والضمان لاتساقها بين جميع الممثلين.

### 2.1 النسخة السحابية (Cloud Replica)
طبقة مرجعية واستمرارية (Persistence) عامة تخدم جميع الممثلين.
* **المرجعية والاستمرارية:** تضمن وجود نسخة الحقيقة العامة وبقاء البيانات متاحة بشكل دائم.
* **منطق القراءة والكتابة:** يستمر جميع الممثلين بالكتابة عليها، ولكن القراءة تكون من خلال النقطة التفتيشية.
* **قاعدة التحقق (Checkpoint Rule):** الممثل لا يقوم بجلب أي تغييرات من السحابة إلا بعد التحقق من آخر نقطة تفتيش لديه.
    * **ملاحظة:** نقطة التفتيش هي رقم تسلسلي لتتبع عمليات الإضافة والتعديل على البيانات.
    * **المعادلة:** <div class="equation">Get all data has write_seq > actor_cp_seq</div>

### 2.2 قناة الأقران (Actors P2P Channel - A2A)
بوابة نقل مباشر بين الممثلين توفر قناة نقل سريعة دون وسيط تخزيني، وتنقسم إلى:
* **نوع عام (Global):** لجميع الممثلين المسجلين في النظام لتبادل النبضات والتغييرات.
* **مجموعات الممثلين (Group Actors):** نوع خاص لمجموعة محددة من الممثلين، وينتخبون قائداً (Leader Election) يتولى مسؤولية الربط وتحقيق الاستمرارية مع المصادر العامة نيابة عن مجموعته.

---

## 3. المصادر الهجينة (Hybrid Mode)
تكامل المصادر لتحقيق المرونة القصوى في المزامنة:
* **المرونة:** يتطلب البروتوكول توفر نوع واحد على الأقل من مصادر الشبكة، والجمع بينهما اختياري.
* **تكامل الأدوار:** تعمل **Cloud Replica** كطبقة استمرارية عامة ومرجع للممثلين الذين فاتهم التفاعل المباشر الذي تم عبر جلسات الـ **Actors P2P Channel**.
* **كفاءة التماثل:** عند استلام الممثل للبيانات من أي مصدر، يتم تحديث الحالة المرجعية محلياً، مما يضمن أن عمليات الجلب (Pull) اللاحقة من السحابة تكون فعالة ولا تستعيد إلا البيانات المفقودة حقاً.




# هيكلية البيانات في بروتوكول AXON

تعتمد النسخة المتماثلة (**The Replica**) في بروتوكول AXON على هيكل بيانات موحد، محايد، ومنطقي تماماً، يفرض سيادته على أي وسيط تخزين (SQL, NoSQL, etc).

### **1. وحدات البناء الأساسية**
يتم تمثيل كافة البيانات وفق التراتبية التالية:
* **List**: تمثل الوعاء (Collection / Table).
* **Item**: تمثل الوحدة البنائية (Document / Row).
* **Field**: تمثل القيم والمفاتيح (Key-Value / Column).

---

### **2. البيانات الوصفية الإجبارية (Item Metadata)**
لضمان اتساق النسخ المتماثلة في الأنظمة الموزعة، يفرض البروتوكول وجود الحقول التالية في كل **Item**:
* `id`: المعرف الفريد للعنصر.
* `checkpoint_since`: الرقم التسلسلي لنقطة تفتيش الكتابة (Write Checkpoint Sequence).
* `updatedAt`: الطابع الزمني لآخر تحديث لضمان ترتيب الأحداث.

---

### **3. استراتيجية "المصادر المتجانسة" (Meta Lists)**
يعالج البروتوكول إدارة نفسه بنفسه من خلال اعتبار "قوائم البيانات الوصفية" قوائم عادية داخل النسخة المتماثلة، وهو ما يحقق ثلاثة أهداف بآن واحد:

#### **أولاً: قائمة القوائم (Meta List)**
يتم تتبع حالة جميع القوائم في النسخة عبر قائمة وصفية، حيث يكون كل عنصر فيها (`Item`) يمثل قائمة موجودة فعلياً:
* `id`: اسم القائمة (List Name).
* `since`: نقطة تفتيش الكتابة الخاصة بالقائمة ككل.
* `actors`: مصفوفة للممثلين النشطين في هذه القائمة. تحتوي على `actor id` & `actor checkpoint_cursor`
* `checkpoint_since`  هو العداد الشامل للـ Meta. يزداد عند أي تغيير في القائمة (إضافة/إزالة ممثل، أو تحديث الـ `since` نفسه). هو المحرك لمزامنة "الحالة الإدارية".
  * 
* `length`: العدد الفعلي للعناصر لضمان مطابقة النسخ.

#### **ثانياً: تتبع الحذف والتطهير (Tombstone List)**
الحذف في AXON ليس مجرد إخفاء للبيانات، بل هو عملية تتبع دقيقة تضمن "نظافة" كافة النسخ. يتم تتبع العناصر المحذوفة عبر قائمة `Tombstone` تحتوي على:
* `id`: معرف العنصر المحذوف.
* `capture_actors_counter`: عدد الممثلين الذين عاصروا وجود العنصر لحظة حذفه.
* `received_actors_counter`: عدد الممثلين الذين أكدوا استلام خبر الحذف.

> **مبدأ التطهير:** بمجرد تساوي العدادين (`capture` و `received`) لدى الممثل، يتم حذف أثر الـ Tombstone نهائياً من كافة النسخ، مما يضمن عدم بقاء أي بيانات لا فائدة منها.و في حات كان length القئمة الاب يساوي 0 يتم حذف meta

---

### **4. الملخص التقني المحدث**

بروتوكول **AXON** هو معيار لتنسيق البيانات بين **النسخة المتماثلة (Replica)** و**المصادر المتعددة (Multi-Sources)**، حيث:
1. يرتكز على دور **الممثل (Actor)** كمدير مستقل.
2. يستخدم **خوارزميات محكمة** تعتمد على نقاط تفتيش دقيق لتبادل الفوارق (Deltas).
3. يضمن **حل التعارض** وترتيب الأحداث منطقياً.
4. يفرض **تطهيراً فورياً** للبيانات الميتة لضمان تماثل ونظافة النسخ.





# نقاط تفتيش المزامنة (Sync Checkpoints)

يعتمد محرك AXON على نظام عدادات منطقية (Logical Clocks) ثنائي المسار لتنظيم تدفق البيانات والحالة الإدارية بين النسخ المتماثلة. الفكرة قربة جداً من lamport clock

---

### **1. هيكلية العدادات في Meta**

يتم تقسيم "زمن القائمة" إلى عدادين مستقلين لضمان كفاءة المزامنة:

* **`since` (عداد القائمة):** يتزايد حصراً عند حدوث تغيير في البيانات (إضافة عنصر `add` أو تحديثه `update`).
* **`checkpoint_since` (عداد الهيكل):** يتتبع حالة كائن الـ Meta ككل. يتزايد عند أي تغيير هيكلي (مثل تسجيل ممثل جديد `add actor` أو إزالته `remove actor`) وأيضاً عند تحديث قيمة الـ `since` نفسها.

---

### **2. مؤشرات الممثل (Actor Cursors)**

لكل ممثل في مصفوفة الـ `actors` سجل تتبع خاص به يتكون من مؤشرين:
1.  **`data_cursor`:** يشير إلى آخر قيمة `since` (بيانات) تمت معالجتها.
2.  **`meta_cursor`:** يشير إلى آخر قيمة `checkpoint_since` (إدارة) تمت معالجتها.

---

### **3. حالة الانعزال والتسوية (Isolation & Settlement)**

في حال انعزال النسخة الأولى (First Replica):
* **خمول النقاط:** تصبح نقاط التفتيش المحلية "خاملة" ولا تُعتبر مرجعاً نهائياً للمنظومة.
* **التسوية:** عند عودة الاتصال، يتم إجراء تسوية شاملة لمطابقة العدادات المحلية مع الحالة العالمية، وإعادة وسم التغييرات المحلية لتبدأ من حيث انتهى العداد العالمي الأحدث.

---

### **4. تنويهات إضافية**

* **تنويه التوازي:** في حال قام أكثر من ممثل بتعديل القائمة في نفس اللحظة وحصلوا على نفس رقم الـ `since` (مثلاً 51)، لا يسبب ذلك أي إشكال؛ حيث يتم سحب كافة التغييرات التي تتجاوز العتبة السابقة دفعة واحدة.
* **تنويه الحذف:** عمليات الحذف ليس لها علاقة بالـ `since` الخاص بالقائمة؛ فبمجرد حذف العنصر يخرج من القائمة نهائياً وتنتقل مسؤولية تتبعه لنظام **Tombstone** المستقل.



# توثيق بروتوكول myReplica: آلية حل تعارض التحديث (Update Conflict Resolution)

يحدد هذا المستند المعايير التقنية التي يتبعها الممثل (**Actor**) لضمان اتساق نسخته الأصلية (**First Replica**) مع المصادر البعيدة (**Remote Sources**) عند وقوع أحداث التحديث.

---

## 1. الهوية والوسم الزمني
* **الحقل الإلزامي:** يجب أن يحتوي كل عنصر (Item) على حقل `updatedAt` من نوع **HLC** (Hybrid Logical Clock).
* **مكونات الطابع:** يتكون `updatedAt` من (الوقت الفيزيائي $T$، العداد المنطقي $C$، ومعرف العقدة $NodeID$).

## 2. منطق حل التعارض (Update Action)
يعتمد البروتوكول استراتيجية **LWW (Last Write Wins)** على مستوى العنصر بالكامل للحقول العادية، ويتم حسم التعارض عند عملية **الاستلام/السحب (Pull/Receive)** وفق القواعد التالية:

### أ. قاعدة المقارنة الأساسية:
عند استلام تحديث، يتم مقارنة `Incoming.updatedAt` مع `Local.updatedAt`:
1.  **الفوز (Accept):** إذا كان الطابع الوارد أكبر، يتم تحديث الـ First Replica بالكامل بالحالة الجديدة.
2.  **التجاهل (Ignore):** إذا كان الطابع الوارد أصغر، يتم الإبقاء على النسخة المحلية.
    * **إجراء إلزامي:** في حالة التجاهل، يجب على الممثل إبلاغ المصدر (**Remote Source**) بالنسخة الأحدث (Corrective Push) لتصحيح الحالة لديه.

### ب. كسر التعادل (Tie-breaking):
في حال تساوي $T$ و $C$ تماماً، يتيح البروتوكول للمطور اختيار أحد المسارين:
* **الحتمي:** استخدام `NodeID` لتقرير الفائز (الأعلى ID يسود).
* **الكشفي:** تفعيل علم `isConflicted` للسماح بمعالجة مخصصة، مع الحفاظ على التقارب التقني.

---

## 3. آلية التسوية (Reconciliation)
عند عودة الممثل من وضع **الانعزالية (Offline Mode)**، تبدأ عملية التسوية للحفاظ على سلامة البيانات:
* يتم الاحتفاظ بكافة التحديثات المحلية أثناء الانعزالية.
* عند الاتصال، يتم غربلة التحديثات؛ التحديثات المحلية التي يثبت أنها أصغر من النسخة القادمة من الشبكة يتم إهمالها لصالح "الحقيقة الأحدث".

---

## 4. سلامة الوقت والقفزة الزمنية (Clock Jump & Drift)
لحماية البروتوكول من انحراف الساعات، يطبق الممثل القواعد التالية:
1.  **التحقق من الفارق (Max Offset):** يتم رفض أو تعليق أي تحديث يتجاوز وقته الفيزيائي فارقاً زمنياً محدداً (مثلاً 60 ثانية) عن وقت الجهاز الحالي.
2.  **القفزة التصحيحية:** عند قبول تحديث أحدث، يقوم الممثل بـ "قفزة" في ساعته المحلية لتتجاوز الطابع المستلم بمقدار ($C + 1$)، مما يضمن أن التحديثات المستقبلية ستحمل دائماً طابعاً أكبر وتتبع التسلسل السببي.

---

## 5. الخلاصة المعمارية
بروتوكول **myReplica** يضمن التقارب الحتمي (**Deterministic Convergence**) بجعل الممثل هو سلطة القرار النهائية، حيث يقوم بتطهير المصادر وتصحيحها بناءً على الختم الزمني الأعلى، مما يضمن أن النسخة الأحدث سببيّاً هي التي تسود في النهاية.



</body>
</html>
